---
title: "find guldet"
subtitle: "Hvis du kan få adgang..."
format: 
  revealjs:
    logo: "kubdatalab.png"
    drop:
      button: true
      shortcut: "å"
    webr:
      packages:
        - tidyverse
        - plotDK
    revealjs-plugins:
      - drop
---

#
![](figs/trompetpiger_top.jpg) 

## Udfordring!

curl virker ikke nativt i webassembler.
Så i stedet må vi kigge på en GET løsning - gennem - url 
https://api.statbank.dk/console#data

https://api.statbank.dk/v1/data/HFUDD11/CSV?BOPOMR=*&HFUDD=H10,H20,H30,H40,H50,H60,H70,H80,H90&Tid=2024

Og det virker!

## Housekeeping

Gå til denne side i din browser

Følg med ved at bruge piletasterne.

Stil endelig spørgsmål!

## Målet
Sådan da. Vi skal nok have den gennem ggplotly så vi faktisk kan styre farverne.
```{r echo = FALSE} 
library(httr2)
library(dplyr)
endpoint <- "http://api.statbank.dk/v1/data"

variables <- list(list(code = "BOPOMR", values = I("*")),
                  list(code = "HFUDD", values = c("H10", "H20", "H30", "H40", "H50", "H60", "H70", "H80", "H90")),
                  list(code = "Tid", values = I(2024))
              )

our_body <- list(table = "HFUDD11", lang = "da", format = "CSV", variables = variables)



resp <- request(endpoint) |>
  req_body_json(our_body) |>
  req_perform()

csv_text <- resp_body_string(resp)


df <- read.csv2(text = csv_text)
df <- df |>mutate(BOPOMR = tolower(BOPOMR))

library(plotDK)
library(dplyr)
library(ggplot2)

df |> 
  group_by(BOPOMR) |> 
  mutate(totbefolk = sum(INDHOLD)) |> 
  mutate(andel = INDHOLD/totbefolk) |> 
  filter(HFUDD == "H10 Grundskole") |> 
plotDK::plotDK(id = "BOPOMR", value = "andel", interactive = TRUE) 
```




## KUB Datalab

Hvem er vi?

## Hvad er R?

Det er et bogstav, der ligger mellem q og s.

## Hvad vil vi vise?

Vi vil hente noget data fra Danmarks Statistik.

og så vil vi gøre ting med det

[Datavejviser](https://www.datavejviser.dk/){target="_blank"}



## Hvordan gør jeg det derhjemme?

Gør dig selv en tjeneste - download og installer [R](https://cran.r-project.org/){target="_blank"} (først) og (dernæst) [Positron](https://positron.posit.co/download.html){target="_blank"}

Der er begrænsninger i denne side som bliver trælse på sigt.

## Trin for trin

Definer hvilke data vi skal have. 

Hent data

Manipuler data

Lidt om plotDK - choropleth

kortet!


## Det samlede script

Her sætter vi det samlede færdige script ind, lige til at kopiere.
plotDK er pakken!

Det er så ikke det vi kommer til at gøre.

```
library(httr2)
endpoint <- "http://api.statbank.dk/v1/data"

variables <- list(list(code = "BOPOMR", values = I("*")),
                  list(code = "HFUDD", values = c("H10", "H20", "H30", "H40", "H50", "H60", "H70", "H80", "H90")),
                  list(code = "Tid", values = I(2024))
              )

our_body <- list(table = "HFUDD11", lang = "da", format = "CSV", variables = variables)



resp <- request(endpoint) |>
  req_body_json(our_body) |>
  req_perform()

csv_text <- resp_body_string(resp)


df <- read.csv2(text = csv_text)
df <- df |>mutate(BOPOMR = tolower(BOPOMR))

plotDK::municipality |> head()

library(plotDK)
library(dplyr)
library(ggplot2)
df |> 
  group_by(BOPOMR) |> 
  mutate(totbefolk = sum(INDHOLD)) |> 
  mutate(andel = INDHOLD/totbefolk) |> 
  filter(HFUDD == "H10 Grundskole") |> 
plotDK::plotDK(id = "BOPOMR", value = "andel", interactive = FALSE)  +
  scale_fill_gradient(low = "blue",
                      high = "red")

```